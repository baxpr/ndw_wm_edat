---
moreauto: true
procversion: 1.0.0
procname: modularity_3study
proctype: modularity_3study_v1

inputs:
  default:
    container_path: baxpr-fmri_modularity-master-v1.0.0.simg
    container_source: shub://baxpr/fmri_modularity:v1.0.0
    extraflags: ""
  xnat:
    assessors:
      - name: assr_conn
        proctypes: FMRI_conncalc_C840_v1
        needs_qc: False
        resources:
          - resource: CONNMAT_R_REMOVEGM_NOSCRUB
            ftype: FILE
            fdest: connmat.txt
            varname: connmat_file
          - resource: ROI_LABELS
            ftype: FILE
            fdest: roilabels.nii.gz
            varname: roi_file
          - resource: ROI_INFO
            ftype: FILE
            fdest: roiinfo.csv
            varname: roiinfo_file

    attrs:
      - varname: project
        object: session
        attr: project
      - varname: subject
        object: session
        attr: subject_label
      - varname: session
        object: session
        attr: label
      - varname: assr_label
        object: assessor
        attr: label
        ref: assr_conn

outputs:
  - path: fmri_modularity.pdf
    type: FILE
    resource: PDF
  - path: modularities.csv
    type: FILE
    resource: MODULARITY
  - path: connectivity_matrix.csv
    type: FILE
    resource: CONN_MAT
  - path: rroi.nii.gz
    type: FILE
    resource: ROI_IMAGE
  - path: communities.csv
    type: FILE
    resource: COMMUNITY_SPEC
  - path: community_assignments.csv
    type: FILE
    resource: COMMUNITY_MODULES

command: >-
  singularity
  run
  --bind $INDIR:/INPUTS
  --bind $OUTDIR:/OUTPUTS
  "{container_path}"
  magick_path /usr/bin
  community_file eight_networks_tcorr05_2level_43_0840rois_3study.csv \
  connmat_file /INPUTS/"{connmat_file}" \
  roiinfo_file /INPUTS/"{roinfo_file}" \
  roi_file /INPUTS/"{roi_file}" \
  project "{project}"
  subject "{subject}"
  session "{session}"
  scan "{assr_label}"
  out_dir /OUTPUTS

attrs:
  xsitype: proc:genProcData
  walltime: '1:00:00'
  memory: 8192
  ppn: 1
jobtemplate: singularity_job_template.txt
